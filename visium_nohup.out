Loading toml file...
Checking toml file...[Seurat]
Checking toml file...[Dataset]
Checking toml file...[Meta Features]
==================================================
Running R script...Extract Seurat data...
Loading required package: SeuratObject
Loading required package: sp

Attaching package: ‘SeuratObject’

The following objects are masked from ‘package:base’:

    intersect, t

── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::between()     masks data.table::between()
✖ tidyr::expand()      masks Matrix::expand()
✖ dplyr::filter()      masks stats::filter()
✖ dplyr::first()       masks data.table::first()
✖ purrr::flatten()     masks jsonlite::flatten()
✖ lubridate::hour()    masks data.table::hour()
✖ lubridate::isoweek() masks data.table::isoweek()
✖ dplyr::lag()         masks stats::lag()
✖ dplyr::last()        masks data.table::last()
✖ lubridate::mday()    masks data.table::mday()
✖ lubridate::minute()  masks data.table::minute()
✖ lubridate::month()   masks data.table::month()
✖ tidyr::pack()        masks Matrix::pack()
✖ lubridate::quarter() masks data.table::quarter()
✖ lubridate::second()  masks data.table::second()
✖ purrr::transpose()   masks data.table::transpose()
✖ tidyr::unpack()      masks Matrix::unpack()
✖ lubridate::wday()    masks data.table::wday()
✖ lubridate::week()    masks data.table::week()
✖ lubridate::yday()    masks data.table::yday()
✖ lubridate::year()    masks data.table::year()
ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors
===================================================
load RDS data...
Extract data...
Save metadata...
Save metadata feature names...
Save umap embedding...
Save images and coordinates...
1 / 96 :  slice1 
2 / 96 :  slice1_BN0329 
3 / 96 :  slice1_BN0339 
4 / 96 :  slice1_BN0341 
5 / 96 :  slice1_BN0347 
6 / 96 :  slice1_BN0348 
7 / 96 :  slice1_BN0415 
8 / 96 :  slice1_BN0452 
9 / 96 :  slice1_BN0464 
10 / 96 :  slice1_BN0536 
11 / 96 :  slice1_BN0602 
12 / 96 :  slice1_BN0615 
13 / 96 :  slice1_BN0635 
14 / 96 :  slice1_BN0644 
15 / 96 :  slice1_BN0651 
16 / 96 :  slice1_BN0655 
17 / 96 :  slice1_BN0662 
18 / 96 :  slice1_BN0704 
19 / 96 :  slice1_BN0737 
20 / 96 :  slice1_BN0746 
21 / 96 :  slice1_BN0855 
22 / 96 :  slice1_BN0934 
23 / 96 :  slice1_BN0952 
24 / 96 :  slice1_BN1022 
25 / 96 :  slice1_BN1076 
26 / 96 :  slice1_BN1128 
27 / 96 :  slice1_BN1144 
28 / 96 :  slice1_BN1160 
29 / 96 :  slice1_BN1204 
30 / 96 :  slice1_BN1206 
31 / 96 :  slice1_BN1221 
32 / 96 :  slice1_BN1266 
33 / 96 :  slice1_BN1305 
34 / 96 :  slice1_BN1308 
35 / 96 :  slice1_BN1317 
36 / 96 :  slice1_BN1339 
37 / 96 :  slice1_BN1340 
38 / 96 :  slice1_BN1351 
39 / 96 :  slice1_BN1361 
40 / 96 :  slice1_BN1412 
41 / 96 :  slice1_BN1424 
42 / 96 :  slice1_BN1430 
43 / 96 :  slice1_BN1504 
44 / 96 :  slice1_BN1506 
45 / 96 :  slice1_BN1518 
46 / 96 :  slice1_BN1535 
47 / 96 :  slice1_BN1546 
48 / 96 :  slice1_BN1554 
49 / 96 :  slice1_BN1567 
50 / 96 :  slice1_BN1578 
51 / 96 :  slice1_BN1585 
52 / 96 :  slice1_BN1614 
53 / 96 :  slice1_BN1644 
54 / 96 :  slice1_BN1719 
55 / 96 :  slice1_BN1722 
56 / 96 :  slice1_BN1726 
57 / 96 :  slice1_BN1730 
58 / 96 :  slice1_BN1737 
59 / 96 :  slice1_BN1741 
60 / 96 :  slice1_BN1747 
61 / 96 :  slice1_BN1749 
62 / 96 :  slice1_BN1750 
63 / 96 :  slice1_BN1752 
64 / 96 :  slice1_BN1756 
65 / 96 :  slice1_BN1762 
66 / 96 :  slice1_BN1805 
67 / 96 :  slice1_BN1809 
68 / 96 :  slice1_BN1812 
69 / 96 :  slice1_BN1814 
70 / 96 :  slice1_BN1817 
71 / 96 :  slice1_BN1822 
72 / 96 :  slice1_BN1827 
73 / 96 :  slice1_BN1836 
74 / 96 :  slice1_BN1839 
75 / 96 :  slice1_BN1842 
76 / 96 :  slice1_BN1848 
77 / 96 :  slice1_BN1849 
78 / 96 :  slice1_BN1855 
79 / 96 :  slice1_BN1862 
80 / 96 :  slice1_BN1864 
81 / 96 :  slice1_BN1865 
82 / 96 :  slice1_BN1878 
83 / 96 :  slice1_BN1902 
84 / 96 :  slice1_BN1910 
85 / 96 :  slice1_BN1934 
86 / 96 :  slice1_BN1939 
87 / 96 :  slice1_BN1957 
88 / 96 :  slice1_BN1959 
89 / 96 :  slice1_BN1960 
90 / 96 :  slice1_BN1974 
91 / 96 :  slice1_BN1975 
92 / 96 :  slice1_BN2003 
93 / 96 :  slice1_BN2015 
94 / 96 :  slice1_BN9944 
95 / 96 :  slice1_BN9947 
96 / 96 :  slice1_BN9966 
Save normalized counts...
Done! Data extraction is done! ^_^ ...
=================================================
Running python script...Prepare meta data...
Selected features: nCount_Spatial,nFeature_Spatial,sample_name,sex,diagnosis,last_mmse_test_score,motor_updrs_score,smoothed_label_s5
============================================
============================================
Dataset path:  datasets/PD5D_MTG_VisiumST
Kept features:  ['nCount_Spatial', 'nFeature_Spatial', 'sample_name', 'sex', 'diagnosis', 'last_mmse_test_score', 'motor_updrs_score', 'smoothed_label_s5']
Rename features:  {}
Sample column:  sample_name
Cluster column:  smoothed_label_s5
Condition column:  diagnosis
Checking inputs...
Loading metadata...
/mnt/data/projects/donglab/ruifeng_2025/SC_ST_AutoProcess/rename_meta_Visium.py:43: DtypeWarning: Columns (16) have mixed types. Specify dtype option on import or set low_memory=False.
  metadata = pd.read_csv(dataset_path + "/raw_metadata.csv", index_col=0, header=0)
Renaming features...
Renaming sample id...
Renaming spot id...
Processing spot metadata...
Processing sample metadata...
/mnt/data/projects/donglab/ruifeng_2025/SC_ST_AutoProcess/rename_meta_Visium.py:138: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '' has dtype incompatible with float64, please explicitly cast to a compatible dtype first.
  sample_meta.fillna("", inplace=True)
Loading embedding ....
Renaming embeddings....
Sampling umap...
Processing coordinates...[renaming barcode to cs_id]
Loading expression data...(Takes a while...be patient...)
Renaming expression....
Saving gene jsons...
Grouping by gene... be patient...
Saving gene... be patient...
1000/32058
2000/32058
3000/32058
4000/32058
5000/32058
6000/32058
7000/32058
8000/32058
9000/32058
10000/32058
11000/32058
12000/32058
13000/32058
14000/32058
15000/32058
16000/32058
17000/32058
18000/32058
19000/32058
20000/32058
21000/32058
22000/32058
23000/32058
24000/32058
25000/32058
26000/32058
27000/32058
28000/32058
29000/32058
30000/32058
31000/32058
32000/32058
=============================================
Calculating pseudo count...
Grouping by gene... be patient...
1000/32058
2000/32058
3000/32058
4000/32058
5000/32058
6000/32058
7000/32058
8000/32058
9000/32058
10000/32058
11000/32058
12000/32058
13000/32058
14000/32058
15000/32058
16000/32058
17000/32058
18000/32058
19000/32058
20000/32058
21000/32058
22000/32058
23000/32058
24000/32058
25000/32058
26000/32058
27000/32058
28000/32058
29000/32058
30000/32058
31000/32058
32000/32058
Done! Feature/Gene data processed and saved.
